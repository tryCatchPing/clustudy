# Requirements Document

## Introduction

페이지 컨트롤러는 노트 내부에서 페이지를 관리할 수 있는 기능입니다. 사용자는 '페이지 설정' 버튼을 통해 새 창/모달창에서 페이지 컨트롤러 화면에 접근할 수 있습니다. 굿노트나 삼성노트와 같은 노트앱처럼 페이지 미리보기를 제공하고, 드래그 앤 드롭을 통한 순서 변경, 페이지 추가/삭제 기능을 지원합니다. 이 기능은 향후 Isar DB 도입을 고려하여 확장 가능한 구조로 설계되어야 합니다.

## Requirements

### Requirement 1

**User Story:** 노트 사용자로서, 노트 내부에서 페이지 설정 버튼을 클릭하여 페이지 컨트롤러 화면에 접근하고 싶습니다. 이를 통해 현재 노트의 모든 페이지를 한눈에 볼 수 있습니다.

#### Acceptance Criteria

1. WHEN 사용자가 노트 편집 화면에서 '페이지 설정' 버튼을 클릭 THEN 시스템은 페이지 컨트롤러 모달/새 창을 표시해야 합니다
2. WHEN 페이지 컨트롤러가 열림 THEN 시스템은 현재 노트의 모든 페이지를 썸네일 형태로 표시해야 합니다
3. WHEN 페이지 썸네일이 표시됨 THEN 각 썸네일은 페이지 번호와 함께 표시되어야 합니다
4. WHEN 페이지가 PDF 배경을 가짐 THEN 썸네일은 PDF 배경과 스케치 내용을 모두 포함해야 합니다
5. WHEN 페이지가 빈 배경을 가짐 THEN 썸네일은 스케치 내용만 표시해야 합니다

### Requirement 2

**User Story:** 노트 사용자로서, 페이지 컨트롤러에서 드래그 앤 드롭을 통해 페이지 순서를 변경하고 싶습니다. 이를 통해 노트의 페이지 구성을 자유롭게 조정할 수 있습니다.

#### Acceptance Criteria

1. WHEN 사용자가 페이지 썸네일을 길게 누름 THEN 시스템은 드래그 모드를 활성화해야 합니다
2. WHEN 드래그 모드가 활성화됨 THEN 선택된 페이지는 시각적으로 구분되어야 합니다
3. WHEN 사용자가 페이지를 드래그함 THEN 시스템은 드롭 가능한 위치를 시각적으로 표시해야 합니다
4. WHEN 사용자가 페이지를 새 위치에 드롭함 THEN 시스템은 페이지 순서를 즉시 업데이트해야 합니다
5. WHEN 페이지 순서가 변경됨 THEN 시스템은 모든 페이지의 pageNumber를 새로운 순서에 맞게 재매핑해야 합니다
6. WHEN 순서 변경이 완료됨 THEN 시스템은 변경사항을 repository에 저장해야 합니다

### Requirement 3

**User Story:** 노트 사용자로서, 페이지 컨트롤러에서 새 페이지를 추가하고 싶습니다. 이를 통해 노트에 필요한 만큼 페이지를 확장할 수 있습니다.

#### Acceptance Criteria

1. WHEN 사용자가 '페이지 추가' 버튼을 클릭 THEN 시스템은 새 빈 페이지를 생성해야 합니다
2. WHEN 새 페이지가 생성됨 THEN 시스템은 해당 페이지를 노트의 마지막 위치에 추가해야 합니다
3. WHEN 새 페이지가 추가됨 THEN 시스템은 적절한 pageNumber를 할당해야 합니다
4. WHEN PDF 기반 노트에서 페이지 추가 THEN 사용자는 빈 페이지만을 선택할 수 있습니다
5. WHEN 페이지 추가가 완료됨 THEN 시스템은 변경사항을 repository에 저장해야 합니다

### Requirement 4

**User Story:** 노트 사용자로서, 페이지 컨트롤러에서 불필요한 페이지를 삭제하고 싶습니다. 이를 통해 노트를 깔끔하게 정리할 수 있습니다.

#### Acceptance Criteria

1. WHEN 사용자가 페이지 썸네일의 삭제 버튼을 클릭 THEN 시스템은 삭제 확인 다이얼로그를 표시해야 합니다
2. WHEN 사용자가 삭제를 확인 THEN 시스템은 해당 페이지를 노트에서 제거해야 합니다
3. WHEN 페이지가 삭제됨 THEN 시스템은 남은 페이지들의 pageNumber를 재매핑해야 합니다
4. WHEN 마지막 페이지를 삭제하려 함 THEN 시스템은 삭제를 거부하고 경고 메시지를 표시해야 합니다
5. WHEN 페이지 삭제가 완료됨 THEN 시스템은 변경사항을 repository에 저장해야 합니다
6. WHEN 페이지가 삭제됨 THEN 시스템은 관련된 썸네일 캐시를 정리해야 합니다

### Requirement 5

**User Story:** 노트 사용자로서, 페이지 컨트롤러에서 페이지 썸네일을 빠르게 볼 수 있기를 원합니다. 이를 통해 페이지 내용을 쉽게 식별하고 관리할 수 있습니다.

#### Acceptance Criteria

1. WHEN 페이지 컨트롤러가 로드됨 THEN 시스템은 모든 페이지의 썸네일을 생성해야 합니다
2. WHEN 썸네일을 생성함 THEN 시스템은 적절한 크기와 품질로 렌더링해야 합니다
3. WHEN 썸네일이 생성됨 THEN 시스템은 성능을 위해 썸네일을 캐시해야 합니다
4. WHEN 페이지 내용이 변경됨 THEN 시스템은 해당 페이지의 썸네일을 무효화하고 재생성해야 합니다
5. WHEN 많은 페이지가 있음 THEN 시스템은 지연 로딩을 통해 성능을 최적화해야 합니다
6. WHEN 썸네일 생성이 실패함 THEN 시스템은 기본 플레이스홀더 이미지를 표시해야 합니다

### Requirement 6

**User Story:** 개발자로서, 페이지 컨트롤러 기능이 향후 Isar DB 도입에 대비하여 확장 가능한 구조로 설계되기를 원합니다. 이를 통해 데이터베이스 변경 시 최소한의 수정으로 대응할 수 있습니다.

#### Acceptance Criteria

1. WHEN 페이지 순서 변경 기능을 구현함 THEN 시스템은 repository 인터페이스를 통해서만 데이터에 접근해야 합니다
2. WHEN 페이지 인덱스 재매핑이 필요함 THEN 시스템은 이를 별도의 서비스로 분리해야 합니다
3. WHEN 썸네일 생성 기능을 구현함 THEN 시스템은 재사용 가능한 서비스로 분리해야 합니다
4. WHEN 페이지 관리 로직을 구현함 THEN 시스템은 비즈니스 로직과 데이터 접근을 분리해야 합니다
5. IF Isar DB가 도입됨 THEN 기존 repository 구현체만 교체하면 되어야 합니다
6. WHEN 대량의 페이지를 처리함 THEN 시스템은 배치 처리를 지원해야 합니다

### Requirement 7

**User Story:** 노트 사용자로서, 페이지 컨트롤러에서 수행한 작업이 안정적으로 처리되기를 원합니다. 이를 통해 데이터 손실 없이 페이지를 관리할 수 있습니다.

#### Acceptance Criteria

1. WHEN 페이지 순서 변경 중 오류가 발생함 THEN 시스템은 이전 상태로 롤백해야 합니다
2. WHEN 페이지 추가/삭제 중 오류가 발생함 THEN 시스템은 사용자에게 명확한 오류 메시지를 표시해야 합니다
3. WHEN 썸네일 생성이 실패함 THEN 시스템은 다른 기능에 영향을 주지 않아야 합니다
4. WHEN 동시에 여러 페이지 작업을 수행함 THEN 시스템은 작업 순서를 보장해야 합니다
5. WHEN 페이지 컨트롤러를 닫음 THEN 시스템은 모든 변경사항이 저장되었는지 확인해야 합니다
6. WHEN 메모리 부족 상황이 발생함 THEN 시스템은 우아하게 처리하고 사용자에게 알려야 합니다
