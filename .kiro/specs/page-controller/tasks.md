# Implementation Plan

- [x] 1. Repository 인터페이스 확장 및 메모리 구현체 업데이트

  - NotesRepository 인터페이스에 페이지 관리 메서드 추가
  - MemoryNotesRepository에 새로운 메서드들 구현
  - 썸네일 메타데이터 모델 생성 및 메모리 저장소 추가
  - _Requirements: 6.1, 6.2, 6.4_

- [x] 2. FileStorageService 확장 - 썸네일 캐시 디렉토리 관리

  - 썸네일 캐시 디렉토리 생성 및 관리 메서드 추가
  - 썸네일 파일 경로 생성 유틸리티 구현
  - 캐시 정리 및 크기 확인 기능 구현
  - _Requirements: 5.3, 5.4_

- [x] 3. PageThumbnailService 구현 - 썸네일 생성 및 캐싱

  - 페이지 썸네일 렌더링 로직 구현 (PDF + 스케치 오버레이)
  - 파일 시스템 캐시 관리 기능 구현
  - 썸네일 메타데이터 관리 기능 구현
  - 기본 플레이스홀더 이미지 처리 추가
  - _Requirements: 5.1, 5.2, 5.3, 5.6_

- [x] 4. PageOrderService 구현 - 페이지 순서 변경 로직

  - 페이지 순서 변경 비즈니스 로직 구현
  - 페이지 번호 재매핑 알고리즘 구현
  - Repository를 통한 영속화 로직 구현
  - 순서 변경 유효성 검사 구현
  - _Requirements: 2.4, 2.5, 2.6_

- [x] 5. PageManagementService 구현 - 페이지 추가/삭제 관리

  - 페이지 생성 로직 구현 (NoteService 활용)
  - Repository를 통한 페이지 추가/삭제 구현
  - 페이지 삭제 유효성 검사 구현 (마지막 페이지 보호)
  - _Requirements: 3.2, 3.6, 4.2, 4.3, 4.4_

- [x] 6. 기존 NoteEditorProvider 확장 - 페이지 컨트롤러 상태 관리

  - 기존 note_editor_provider에 페이지 컨트롤러 관련 상태 추가
  - 썸네일 로딩 상태 관리 구현
  - 드래그 앤 드롭 상태 관리 구현
  - 오류 상태 및 로딩 상태 관리 구현
  - _Requirements: 7.1, 7.2, 7.4_

- [x] 7. DraggablePageThumbnail 위젯 구현

  - 드래그 가능한 썸네일 위젯 기본 구조 구현
  - 길게 누르기로 드래그 모드 활성화 구현
  - 썸네일 이미지 표시 및 로딩 상태 처리 구현
  - 삭제 버튼 오버레이 구현
  - _Requirements: 1.3, 1.4, 1.5, 4.1_

- [ ] 8. PageThumbnailGrid 위젯 구현

  - 그리드 형태 썸네일 레이아웃 구현
  - 드래그 앤 드롭 지원 구현 (ReorderableWrap 또는 커스텀)
  - 지연 로딩 및 가상화 지원 구현
  - 드롭 가능한 위치 시각적 표시 구현
  - _Requirements: 2.1, 2.2, 2.3, 5.5_

- [ ] 9. PageControllerScreen 모달 화면 구현

  - 모달 다이얼로그 기본 구조 구현
  - PageThumbnailGrid 통합 및 상태 연결
  - 페이지 추가 버튼 및 기능 구현
  - 모달 닫기 및 변경사항 저장 확인 구현
  - _Requirements: 1.1, 1.2, 7.5_

- [ ] 10. 페이지 추가 기능 구현 (빈 페이지만)

  - 빈 페이지 추가 기능 구현
  - 페이지 삽입 위치 선택 기능 구현 (기본: 마지막 위치)
  - 페이지 추가 후 썸네일 자동 생성 구현
  - _Requirements: 3.1, 3.2, 3.6_

- [ ] 11. 페이지 삭제 기능 구현

  - 삭제 확인 다이얼로그 구현
  - 마지막 페이지 삭제 방지 로직 구현
  - 페이지 삭제 후 인덱스 재매핑 구현
  - 관련 썸네일 캐시 정리 구현
  - _Requirements: 4.1, 4.2, 4.3, 4.5, 4.6_

- [ ] 12. 드래그 앤 드롭 순서 변경 구현

  - 드래그 시작 시 시각적 피드백 구현
  - 드롭 위치 표시 및 유효성 검사 구현
  - 순서 변경 완료 시 즉시 UI 업데이트 구현
  - 순서 변경 실패 시 롤백 메커니즘 구현
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 7.1_

- [ ] 13. 오류 처리 및 사용자 피드백 구현

  - 썸네일 생성 실패 시 플레이스홀더 표시 구현
  - 페이지 작업 실패 시 오류 메시지 표시 구현
  - 로딩 상태 표시 (스켈레톤 UI) 구현
  - 메모리 부족 상황 감지 및 대응 구현
  - _Requirements: 5.6, 7.2, 7.3, 7.6_

- [ ] 14. 기본 성능 최적화 구현

  - 썸네일 기본 캐싱 구현 (파일 시스템 캐시)
  - UI 반응성 기본 최적화 (로딩 상태 표시)
  - 메모리 사용량 기본 관리 (썸네일 해제)
  - _Requirements: 5.3, 7.4_

- [ ] 15. 노트 편집 화면에 페이지 설정 버튼 추가

  - 노트 편집 화면에 '페이지 설정' 버튼 추가
  - 버튼 클릭 시 PageControllerScreen 모달 호출 구현
  - 페이지 컨트롤러 종료 후 노트 화면 새로고침 구현
  - _Requirements: 1.1_

- [ ] 16. 통합 테스트 및 버그 수정
  - 전체 페이지 컨트롤러 워크플로우 테스트
  - 대량 페이지 처리 성능 테스트
  - 메모리 사용량 모니터링 및 최적화
  - 발견된 버그 수정 및 안정성 개선
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_
