# ν…μ¤νΈ κ°€μ΄λ“

μ΄ λ””λ ‰ν† λ¦¬λ” IT Contest μ•±μ ν•µμ‹¬ κΈ°λ¥λ“¤μ— λ€ν• ν¬κ΄„μ μΈ ν…μ¤νΈ μ¤μ„νΈλ¥Ό ν¬ν•¨ν•©λ‹λ‹¤.

## π“ ν…μ¤νΈ κµ¬μ΅°

```
test/
β”β”€β”€ unit/                          # μ λ‹› ν…μ¤νΈ
β”‚   β”β”€β”€ db/                        # λ°μ΄ν„°λ² μ΄μ¤ κ΄€λ ¨ ν…μ¤νΈ
β”‚   β”‚   β””β”€β”€ unique_constraints_test.dart   # μ λ‹ν¬ μ μ•½ μ΅°κ±΄ ν…μ¤νΈ
β”‚   β”β”€β”€ backup/                    # λ°±μ—… μ‹μ¤ν… ν…μ¤νΈ
β”‚   β”‚   β””β”€β”€ backup_service_test.dart       # λ°±μ—…/λ³µμ› κΈ°λ¥ ν…μ¤νΈ
β”‚   β”β”€β”€ link/                      # λ§ν¬ μ‹μ¤ν… ν…μ¤νΈ
β”‚   β”‚   β””β”€β”€ link_sync_test.dart            # λ§ν¬ λ™κΈ°ν™” ν…μ¤νΈ
β”‚   β”β”€β”€ encryption/                # μ•”νΈν™” μ‹μ¤ν… ν…μ¤νΈ
β”‚   β”‚   β””β”€β”€ crypto_key_service_test.dart   # μ•”νΈν™” ν‚¤ κ΄€λ¦¬ ν…μ¤νΈ
β”‚   β””β”€β”€ move/                      # μ΄λ™ κΈ°λ¥ ν…μ¤νΈ
β”‚       β””β”€β”€ move_service_test.dart         # λ…ΈνΈ/ν΄λ” μ΄λ™ ν…μ¤νΈ
β”β”€β”€ integration/                   # ν†µν•© ν…μ¤νΈ
β”‚   β””β”€β”€ full_backup_restore_test.dart     # μ „μ²΄ λ°±μ—…/λ³µμ› μ›ν¬ν”λ΅μ° ν…μ¤νΈ
β”β”€β”€ test_helper.dart               # κ³µν†µ ν…μ¤νΈ μ ν‹Έλ¦¬ν‹°
β”β”€β”€ widget_test.dart               # μ„μ ― ν…μ¤νΈ (κΈ°λ³Έ)
β””β”€β”€ README.md                      # μ΄ νμΌ
```

## π§ ν…μ¤νΈ μΉ΄ν…κ³ λ¦¬

### 1. μ λ‹ν¬ μ μ•½ μ΅°κ±΄ ν…μ¤νΈ (`unit/db/unique_constraints_test.dart`)
- **Vault** `nameLowerUnique` μ μ•½ (λ€μ†λ¬Έμ λ¬΄μ‹ μ¤‘λ³µ λ°©μ§€)
- **Folder** `nameLowerForVaultUnique` μ μ•½ (λ³ΌνΈ λ‚΄ μ¤‘λ³µ λ°©μ§€)
- **Note** `nameLowerForParentUnique` μ μ•½ (ν΄λ” λ‚΄ μ¤‘λ³µ λ°©μ§€)
- **GraphEdge** λ³µν•© μ λ‹ν¬ μ μ•½ `(vaultId, fromNoteId, toNoteId)`
- **PdfCacheMeta** λ³µν•© μ λ‹ν¬ μ μ•½ `(noteId, pageIndex)`
- **RecentTabs** `userId` μ λ‹ν¬ μ μ•½

### 2. λ°±μ—…/λ³µμ› μ‹μ¤ν… ν…μ¤νΈ (`unit/backup/backup_service_test.dart`)
- κΈ°λ³Έ λ°μ΄ν„°λ² μ΄μ¤ λ°±μ—… μƒμ„±/μ‚­μ 
- ν†µν•© λ°±μ—… (DB + PDF νμΌ) μƒμ„±
- AES μ•”νΈν™” λ°±μ—… μƒμ„±/λ³µμ›
- λ°±μ—… λ©λ΅ μ΅°ν λ° μƒνƒ λ¨λ‹ν„°λ§
- λ°±μ—… ν…μ¤νΈ λ° κ²€μ¦ κΈ°λ¥
- λ°±μ—… λ³µμ› λ° λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦

### 3. λ§ν¬ λ™κΈ°ν™” ν…μ¤νΈ (`unit/link/link_sync_test.dart`)
- μμ—­μ—μ„ λ§ν¬λ λ…ΈνΈ μƒμ„±
- λ§ν¬μ™€ κ·Έλν”„ μ—£μ§€ λ™κΈ°ν™”
- μΆν‘ μ •κ·ν™” λ° μ ν¨μ„± κ²€μ¦
- κ³ μ  λΌλ²¨ μƒμ„± (μ¤‘λ³µ μ‹ λ²νΈ μ¶”κ°€)
- μ†ν”„νΈ μ‚­μ  μ‹ dangling λ§ν¬ μ²λ¦¬
- λ³µμ› μ‹ dangling ν”λκ·Έ μ •λ¦¬
- κ·Έλν”„ μ—£μ§€ μ¤‘λ³µ λ°©μ§€

### 4. μ•”νΈν™” μ‹μ¤ν… ν…μ¤νΈ (`unit/encryption/crypto_key_service_test.dart`)
- μ•”νΈν™” ν‚¤ μƒμ„±/λ΅λ“/κ²€μ¦
- ν‚¤ νμ „ λ° λ°±μ—… κ΄€λ¦¬
- λ°μ΄ν„°λ² μ΄μ¤ μ¬μ•”νΈν™”
- IsarDb μ•”νΈν™” ν† κΈ€ κΈ°λ¥
- λ…μ‹μ  μ•”νΈν™” ν‚¤ μ‚¬μ©

### 5. ν†µν•© μ›ν¬ν”λ΅μ° ν…μ¤νΈ (`integration/full_backup_restore_test.dart`)
- μ™„μ „ν• λ°μ΄ν„° κµ¬μ΅° μƒμ„± (λ³ΌνΈ, ν΄λ”, λ…ΈνΈ, νμ΄μ§€, μΊ”λ²„μ¤, λ§ν¬ λ“±)
- ν†µν•© λ°±μ—… λ° μ™„μ „ λ³µμ›
- λ°μ΄ν„° κ΄€κ³„ λ¬΄κ²°μ„± κ²€μ¦
- μ•”νΈν™” λ°±μ—…/λ³µμ› μ›ν¬ν”λ΅μ°
- PDF νμΌ ν¬ν•¨ λ°±μ—…/λ³µμ›

## π€ ν…μ¤νΈ μ‹¤ν–‰ λ°©λ²•

### λ¨λ“  ν…μ¤νΈ μ‹¤ν–‰
```bash
flutter test
```

### νΉμ • μΉ΄ν…κ³ λ¦¬ ν…μ¤νΈ μ‹¤ν–‰
```bash
# μ λ‹ν¬ μ μ•½ μ΅°κ±΄ ν…μ¤νΈ
flutter test test/unit/db/unique_constraints_test.dart

# λ°±μ—… μ‹μ¤ν… ν…μ¤νΈ
flutter test test/unit/backup/backup_service_test.dart

# λ§ν¬ λ™κΈ°ν™” ν…μ¤νΈ
flutter test test/unit/link/link_sync_test.dart

# μ•”νΈν™” μ‹μ¤ν… ν…μ¤νΈ
flutter test test/unit/encryption/crypto_key_service_test.dart

# ν†µν•© ν…μ¤νΈ
flutter test test/integration/full_backup_restore_test.dart
```

### ν…μ¤νΈ μ‹¤ν–‰ μµμ…
```bash
# μμ„Έν• μ¶λ ¥μΌλ΅ μ‹¤ν–‰
flutter test --reporter=expanded

# νΉμ • ν…μ¤νΈλ§ μ‹¤ν–‰ (ν¨ν„΄ λ§¤μΉ­)
flutter test --name="unique constraint"

# μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬νΈ μƒμ„±
flutter test --coverage
```

## β οΈ μ¤‘μ” μ‚¬ν•­

### λ„¤μ΄ν‹°λΈ λ°νƒ€μ„ μ”κµ¬μ‚¬ν•­
λ€λ¶€λ¶„μ ν…μ¤νΈλ” Isar λ„¤μ΄ν‹°λΈ λ°νƒ€μ„μ΄ ν•„μ”ν•λ―€λ΅ `skip` ν”λκ·Έκ°€ μ„¤μ •λμ–΄ μμµλ‹λ‹¤. μ‹¤μ  ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•λ ¤λ©΄:

1. **λ°μ¤ν¬ν†±μ—μ„ μ‹¤ν–‰:**
   ```bash
   flutter test --platform=chrome
   ```

2. **λ””λ°”μ΄μ¤/μ—λ®¬λ μ΄ν„°μ—μ„ μ‹¤ν–‰:**
   ```bash
   flutter test test/integration/ --device-id=<device_id>
   ```

3. **ν†µν•© ν…μ¤νΈλ΅ μ‹¤ν–‰:**
   ```bash
   flutter drive --target=test_driver/app.dart
   ```

### Mock μ„¤μ •
λ¨λ“  ν…μ¤νΈλ” λ‹¤μμ„ μλ™μΌλ΅ mockν•©λ‹λ‹¤:
- `path_provider` (μ„μ‹ λ””λ ‰ν† λ¦¬ μ‚¬μ©)
- `flutter_secure_storage` (λ©”λ¨λ¦¬ κΈ°λ° μ €μ¥μ†)
- νμΌ μ‹μ¤ν… (κ²©λ¦¬λ μ„μ‹ λ””λ ‰ν† λ¦¬)

### ν…μ¤νΈ λ°μ΄ν„° μ •λ¦¬
κ° ν…μ¤νΈ ν›„μ— μλ™μΌλ΅:
- μ„μ‹ λ””λ ‰ν† λ¦¬ μ‚­μ 
- Mock ν•Έλ“¤λ¬ μ •λ¦¬
- Isar λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μΆ…λ£

## π“ μ»¤λ²„λ¦¬μ§€ λ©ν‘

μ΄ ν…μ¤νΈ μ¤μ„νΈλ” λ‹¤μ ν•µμ‹¬ κΈ°λ¥λ“¤μ λ†’μ€ μ»¤λ²„λ¦¬μ§€λ¥Ό λ©ν‘λ΅ ν•©λ‹λ‹¤:

- β… **λ°μ΄ν„° λ¬΄κ²°μ„±**: μ λ‹ν¬ μ μ•½ μ΅°κ±΄ λ° κ΄€κ³„ κ²€μ¦
- β… **λ°±μ—…/λ³µμ›**: λ°μ΄ν„° μ†μ‹¤ λ°©μ§€ λ° μ™„μ „ν• λ³µκµ¬
- β… **λ§ν¬ μ‹μ¤ν…**: λ…ΈνΈ κ°„ μ—°κ²° λ° κ·Έλν”„ λ™κΈ°ν™”
- β… **μ•”νΈν™”**: λ―Όκ°ν• λ°μ΄ν„° λ³΄νΈ λ° ν‚¤ κ΄€λ¦¬
- β… **μ›ν¬ν”λ΅μ°**: μ‹¤μ  μ‚¬μ© μ‹λ‚λ¦¬μ¤ ν†µν•© ν…μ¤νΈ

## π› λ¬Έμ  ν•΄κ²°

### μΌλ°μ μΈ λ¬Έμ λ“¤

1. **Isar λ°νƒ€μ„ μ¤λ¥**
   - λ„¤μ΄ν‹°λΈ ν”λ«νΌμ—μ„ μ‹¤ν–‰λμ–΄μ•Ό ν•¨
   - `isar_flutter_libs` ν¨ν‚¤μ§€ ν™•μΈ

2. **κ¶ν• μ¤λ¥**
   - ν…μ¤νΈμ© μ„μ‹ λ””λ ‰ν† λ¦¬ μƒμ„± κ¶ν• ν™•μΈ
   - ν”λ«νΌλ³„ κ¶ν• μ„¤μ • ν™•μΈ

3. **λ©”λ¨λ¦¬ λ„μ**
   - κ° ν…μ¤νΈ ν›„ `tearDown`μ—μ„ μ •λ¦¬ ν™•μΈ
   - λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μΆ…λ£ ν™•μΈ

### λ””λ²„κΉ… ν

```bash
# μμ„Έν• λ΅κ·Έμ™€ ν•¨κ» μ‹¤ν–‰
flutter test --verbose

# νΉμ • ν…μ¤νΈλ§ λ””λ²„κ·Έ
flutter test --name="specific test name" --verbose

# μ‹¤ν¨ν• ν…μ¤νΈλ§ μ¬μ‹¤ν–‰
flutter test --run-skipped
```

## π¤ κΈ°μ—¬ κ°€μ΄λ“

μƒλ΅μ΄ κΈ°λ¥ μ¶”κ°€ μ‹ ν…μ¤νΈ μ‘μ„± κ¶μ¥μ‚¬ν•­:

1. **μ λ‹› ν…μ¤νΈ**: κ°λ³„ ν•¨μ/λ©”μ„λ“ ν…μ¤νΈ
2. **ν†µν•© ν…μ¤νΈ**: μ—¬λ¬ μ»΄ν¬λ„νΈ μƒνΈμ‘μ© ν…μ¤νΈ
3. **μ—£μ§€ μΌ€μ΄μ¤**: μμ™Έ μƒν™© λ° κ²½κ³„κ°’ ν…μ¤νΈ
4. **μ„±λ¥ ν…μ¤νΈ**: λ€μ©λ‰ λ°μ΄ν„° μ²λ¦¬ κ²€μ¦

ν…μ¤νΈ μ‘μ„± μ‹ `test_helper.dart`μ κ³µν†µ μ ν‹Έλ¦¬ν‹°λ¥Ό ν™μ©ν•μ—¬ μΌκ΄€λ ν…μ¤νΈ ν™κ²½μ„ κµ¬μ„±ν•μ„Έμ”.
